<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Causal Inference · Omega.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Omega.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../basictutorial/">Basic Tutorial</a></li><li><a class="tocitem" href="../model/">Modeling</a></li><li><a class="tocitem" href="../inference/">Conditional Inference</a></li><li><a class="tocitem" href="../soft/">Soft Execution</a></li><li><span class="tocitem">Inference Algorithms</span><ul><li><a class="tocitem" href="../inferencealgorithms/">Sampling Algorithms</a></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li></ul></li><li><span class="tocitem">Causal Inference</span><ul><li class="is-active"><a class="tocitem" href>Causal Inference</a><ul class="internal"><li><a class="tocitem" href="#Causal-Intervention-the-intervene-operator"><span>Causal Intervention - the <code>intervene</code> operator</span></a></li><li class="toplevel"><a class="tocitem" href="#Counterfactuals"><span>Counterfactuals</span></a></li><li><a class="tocitem" href="#Counter-Factual"><span>Counter Factual</span></a></li><li class="toplevel"><a class="tocitem" href="#Causal-Patterns"><span>Causal Patterns</span></a></li></ul></li><li><a class="tocitem" href="../basiccausal/">Tutorial</a></li><li><a class="tocitem" href="../correspondence/">Preservation</a></li></ul></li><li><a class="tocitem" href="../higher/">Distributional Inference</a></li><li><a class="tocitem" href="../distributions/">Built-in Distributions</a></li><li><a class="tocitem" href="../cheatsheet/">Cheat Sheet</a></li><li><a class="tocitem" href="../faq/">FAQ</a></li><li><a class="tocitem" href="../performance/">Performance Tips</a></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../internalsoverview/">Overview</a></li><li><a class="tocitem" href="../omega/">Ω</a></li><li><a class="tocitem" href="../randvar/">RandVar</a></li></ul></li><li><a class="tocitem" href="../contrib/">Contribution Guide</a></li><li><a class="tocitem" href="../omegavsotherppls/">Omega vs other PPLs</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Causal Inference</a></li><li class="is-active"><a href>Causal Inference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Causal Inference</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/zenna/Omega.jl/blob/master/docs/src/causal.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Causal-Inference"><a class="docs-heading-anchor" href="#Causal-Inference">Causal Inference</a><a id="Causal-Inference-1"></a><a class="docs-heading-anchor-permalink" href="#Causal-Inference" title="Permalink"></a></h1><p>Omega supports causal inference through the <code>intervene</code> function.  Causal inference is a topic of much confusion, we recommend this <a href="https://www.inference.vc/untitled/">blog post</a> for a primer.</p><h2 id="Causal-Intervention-the-intervene-operator"><a class="docs-heading-anchor" href="#Causal-Intervention-the-intervene-operator">Causal Intervention - the <code>intervene</code> operator</a><a id="Causal-Intervention-the-intervene-operator-1"></a><a class="docs-heading-anchor-permalink" href="#Causal-Intervention-the-intervene-operator" title="Permalink"></a></h2><p>The <code>intervene</code> operator models an intervention to a model. It changes the model.</p><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>Omega.intervene</code>. Check Documenter&#39;s build log for details.</p></div></div><p>In Omega we use the syntax:</p><pre><code class="language-julia hljs">intervene(X, θold =&gt; θnew)</code></pre><p>To mean the random variable <code>X</code> where <code>θold</code> has been replaced with <code>θnew</code>.  For this to be a worthwhile thing to do, <code>X</code> should causally depend on<code>θold</code> in the sense that the computation of <code>X</code> requires the computation of <code>θold</code>.</p><p>Let&#39;s look at an example:</p><pre><code class="language-julia hljs">julia&gt; μold = @~ Normal(0.0, 1.0)

julia&gt; x = @~ Normal.(μold, 1.0)

julia&gt; μnew = 100.0

julia&gt; xnew = intervene(x, μold =&gt; μnew)
julia&gt; randsample((x, xnew))
(-2.664230595692529, 96.99998702926271)</code></pre><p>Observe that the sample from <code>xnew</code> is much greater, because it has the mean of <code>100</code></p><h3 id="Replace-a-Random-Variable-with-a-Random-Variable"><a class="docs-heading-anchor" href="#Replace-a-Random-Variable-with-a-Random-Variable">Replace a Random Variable with a Random Variable</a><a id="Replace-a-Random-Variable-with-a-Random-Variable-1"></a><a class="docs-heading-anchor-permalink" href="#Replace-a-Random-Variable-with-a-Random-Variable" title="Permalink"></a></h3><p>Repacing a random variable with a constant is actually a special case of replacing a random variable with another random variable.  The syntax is the same:</p><pre><code class="language-julia hljs">julia&gt; xnewnew = intervene(x, μold =&gt; @~ Normal(200.0, 1.0))
julia&gt; randsample((x, xnew, xnewnew))
(-1.2756627673001866, 99.1080578175426, 198.14711316585564)</code></pre><h3 id="Changing-Multiple-Variables"><a class="docs-heading-anchor" href="#Changing-Multiple-Variables">Changing Multiple Variables</a><a id="Changing-Multiple-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Changing-Multiple-Variables" title="Permalink"></a></h3><p><code>intervene</code> allow you to change many variables at once – simply pass in a tuple of pairs:</p><pre><code class="language-julia hljs">μ1 = @~ Normal(0, 1)
μ2 = @~ Normal(0, 1)
y = @~ Normal.(μ1 .+ μ2, 1)
xnewmulti = intervene(y, (μ1 =&gt; (@~ Normal(200.0, 1.0)), μ2 =&gt; (@~ Normal(300.0, 1.0))))
randsample((xnewmulti))
(-1.2756627673001866, 99.1080578175426, 198.14711316585564)</code></pre><h1 id="Counterfactuals"><a class="docs-heading-anchor" href="#Counterfactuals">Counterfactuals</a><a id="Counterfactuals-1"></a><a class="docs-heading-anchor-permalink" href="#Counterfactuals" title="Permalink"></a></h1><p>The utility of <code>intervene</code> may not be obvious at first glance. We can use <code>intervene</code> and <code>cnd</code> separately and in combination to ask lots of different kinds of questions.</p><p>In this example, we model the relationship betwee the weather outside and the thermometer reading inside a house. Broadly, the model says that the weather outside is dictataed by the time of day, while the temperature inside is determined by whether the air conditioning is on, and whether the window is open.</p><p>First, setup simple priors over the time of day, and variables to determine whether the air conditioning is on and whether the iwndow is open:</p><pre><code class="language-julia hljs">timeofday = @~ UniformDraw([:morning, :afternoon, :evening])
is_window_open = @~ Bernoulli(0.5)
is_ac_on = @~ Bernoulli(0.3)</code></pre><p>Second, assume that the outside temperature depends on the time of day, being hottest in the afternoon, but cold at night:</p><pre><code class="language-julia hljs">function outside_temp(ω)
  if timeofday(ω) == :morning
    @~ Normal(ω, 20.0, 1.0)
  elseif timeofday(ω) == :afternoon
    @~ Normal(ω, 32.0, 1.0)
  else
    @~ Normal(ω, 10.0, 1.0)
  end
end</code></pre><p>The <code>inside_temp</code> before considering the effects of the window is room temperature, unless the ac is on, which makes it colder.</p><pre><code class="language-julia hljs">function inside_temp_(rng)
  if is_ac_on(rng)
    normal(rng, 20.0, 1.0)
  else
    normal(rng, 25.0, 1.0)
  end
end

inside_temp = ciid(inside_temp_, T=Float64)</code></pre><p>Finally, the thermostat reading is <code>inside_temp</code> if the window is closed (we have perfect insulation), otherwise it&#39;s just the average of the outside and inside temperature</p><pre><code class="language-julia hljs">function thermostat_(rng)
  if is_window_open(rng)
    (outside_temp(rng) + inside_temp(rng)) / 2.0
  else
    inside_temp(rng)
  end
end

thermostat = ciid(thermostat_, T=Float64)</code></pre><p>Now with the model built, we can ask some questions:</p><h3 id="Samples-from-the-prior"><a class="docs-heading-anchor" href="#Samples-from-the-prior">Samples from the prior</a><a id="Samples-from-the-prior-1"></a><a class="docs-heading-anchor-permalink" href="#Samples-from-the-prior" title="Permalink"></a></h3><p>The simplest task is to sample from the prior:</p><pre><code class="language-julia hljs">julia&gt; rand((timeofday, is_window_open, is_ac_on, outside_temp, inside_temp, thermostat), 5, alg = RejectionSample)
5-element Array{Tuple{Symbol,Bool,Bool,Float64,Float64,Float64},1}:
 (:evening, true, false, 10.310689624432637, 26.144122188682584, 18.22740590655761)
 (:afternoon, false, false, 32.30806450465544, 22.861739827796345, 22.861739827796345)
 (:morning, false, false, 20.161172183596964, 25.128141190979573, 25.128141190979573)
 (:evening, true, false, 10.239806337680982, 26.81486040128365, 18.527333369482314)
 (:morning, true, false, 20.56559745560037, 27.380632072360157, 23.973114763980263)</code></pre><h3 id="Conditional-Inference"><a class="docs-heading-anchor" href="#Conditional-Inference">Conditional Inference</a><a id="Conditional-Inference-1"></a><a class="docs-heading-anchor-permalink" href="#Conditional-Inference" title="Permalink"></a></h3><ul><li>You enter the room and the thermostat reads hot. what does this tell you about the variables?</li></ul><pre><code class="language-julia hljs">
julia&gt; samples = rand((timeofday, is_window_open, is_ac_on, outside_temp, inside_temp, thermostat),
                       thermostat &gt; 30.0, 5, alg = RejectionSample)
5-element Array{Tuple{Symbol,Bool,Bool,Float64,Float64,Float64},1}:
 (:afternoon, true, false, 32.66172359406305, 28.459719413318684, 30.560721503690864)
 (:afternoon, true, false, 33.411018400286764, 26.638821969105173, 30.02492018469597)
 (:afternoon, true, false, 32.92666992107552, 27.87634864444088, 30.4015092827582)
 (:afternoon, true, false, 34.941029761615916, 25.66825864439438, 30.304644203005147)
 (:afternoon, true, false, 33.82296040117437, 26.237305008998273, 30.030132705086324)</code></pre><h2 id="Counter-Factual"><a class="docs-heading-anchor" href="#Counter-Factual">Counter Factual</a><a id="Counter-Factual-1"></a><a class="docs-heading-anchor-permalink" href="#Counter-Factual" title="Permalink"></a></h2><ul><li>If I were to close the window, and turn on the AC would that make it hotter or colder&quot;</li></ul><pre><code class="nohighlight hljs">thermostatnew = intervene(thermostat, is_ac_on =&gt; true, is_window_open =&gt; false)
diffsamples = rand(thermostatnew - thermostat, 10000, alg = RejectionSample)
julia&gt; mean(diffsamples)
-4.246869797640215</code></pre><p>So in expectation, that intervention will make the thermostat colder.  But we can look more closely at the distribution:</p><pre><code class="nohighlight hljs">julia&gt; UnicodePlots.histogram(diffsamples)

                 ┌────────────────────────────────────────┐ 
   (-11.0,-10.0] │ 37                                     │ 
    (-10.0,-9.0] │▇▇▇▇ 502                                │ 
     (-9.0,-8.0] │▇▇▇▇▇▇▇▇▇▇▇ 1269                        │ 
     (-8.0,-7.0] │▇▇▇▇▇ 581                               │ 
     (-7.0,-6.0] │▇▇▇▇ 497                                │ 
     (-6.0,-5.0] │▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇ 3926 │ 
     (-5.0,-4.0] │▇ 65                                    │ 
     (-4.0,-3.0] │ 5                                      │ 
     (-3.0,-2.0] │ 3                                      │ 
     (-2.0,-1.0] │▇ 97                                    │ 
      (-1.0,0.0] │▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇ 1960                  │ 
       (0.0,1.0] │▇▇▇▇ 494                                │ 
       (1.0,2.0] │▇▇ 197                                  │ 
       (2.0,3.0] │▇▇ 237                                  │ 
       (3.0,4.0] │▇ 118                                   │ 
       (4.0,5.0] │ 12                                     │ 
                 └────────────────────────────────────────┘ </code></pre><ul><li>In what scenarios would it still be hotter after turning on the AC and closing the window?</li></ul><pre><code class="nohighlight hljs">julia&gt; rand((timeofday, outside_temp, inside_temp, thermostat), thermostatnew - thermostat &gt; 0.0, 5, alg = RejectionSample)
5-element Array{Tuple{Symbol,Float64,Float64,Float64},1}:
 (:evening, 8.99858009405822, 26.42261048649467, 17.710595290276444)
 (:evening, 11.016416633842283, 24.852317088939945, 17.934366861391112)
 (:evening, 9.744613418296744, 25.556084959799456, 17.6503491890481)
 (:evening, 9.381925134669295, 25.6283276833937, 17.505126409031497)
 (:evening, 9.121300508670375, 25.182478479511474, 17.151889494090923)</code></pre><h1 id="Causal-Patterns"><a class="docs-heading-anchor" href="#Causal-Patterns">Causal Patterns</a><a id="Causal-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Causal-Patterns" title="Permalink"></a></h1></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../callbacks/">« Callbacks</a><a class="docs-footer-nextpage" href="../basiccausal/">Tutorial »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 16 February 2023 05:10">Thursday 16 February 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
